Elizabeth BachEnvironmental microbial community analysisJune 2015After successfully generating an OTU table and assigned taxonomies, this guide will outline a common series of community analyses that can be performed.  The accompanying R code can be found in the follow GitHub repository and is available for open download by any interested party:  ebach/microbial_community_analysis_teachingPlease keep in mind there are many ways to analyze microbial community data and this guide outlines the approach I most commonly use (see Bach et al. 2015 in submission).  Depending on your data you may want to use additional analysis, or an entirely alternative approach.  I recommend communicating early and often with co-authors to ensure data is being processed correctly and the analyses will produce measures that will address your specific hypotheses.Coming from QIIME, the OTU table will first need some processing to ensure it is structured correctly for subsequent data analyses.  The code Bach_ITS1_data_wrangling.R will perform the following functions:* Transpose data frame so it reads samples by OTUs (samples are rows, OTUs are columns)* Remove singletons (if this was not done in QIIME)* Look at depth of sequencing across samples and rarefaction curves to inform decisions about rarifying data* Code for rarifying data, if determined appropriate* This code will produce a data_rar.csv file, which you will use in subsequent analyses, so you will only need to run this code once after extracting an OTU table from QIIMENext, you will likely want to create a merged .csv integrating the taxonomic assignments with the OTU information.  The code Bach_ITS1_taxonomy_merge.R will perform the following functions:* This will generate a data frame with samples and OTUs in rows (each OTU occurring in each sample will be a separate row), and the taxonomic information (and any metadata) across columns.  OTUs that occur in multiple samples will be replicated on multiple rows.* Write a .csv with the taxonomy information for additional analyses* Code at end provides some quick ways to look at data, number of OTUs per sample or factor, list of OTUs found in each sample or factor levelDiversity analyses are performed with the OTU table directly, so you do not necessarily need to use the merged taxonomy file* This will calculate richness (alpha diversity), evenness, and Shannon’s diversity.  Other diversity indices can easily be added using the diversity() function (use ?diversity() to see options)* This code also evaluates the distribution of data, helping to identify outliers and see if transformations are necessary for ANOVA comparisons* Compare and select statistical models (both linear and mixed model examples included) to determine if there are any differences in diversity metrics between treatment factors evaluated* This code will also generate “quick & dirty” graphs to get an initial idea of what these differences areTo generate initial non-metric multi-dimensional scaling (NMDS) ordinations, use the Bach_NMDS_exploration.R code.  This file is for initial visualization of community differences.* This code will perform NMDS ordinations based on presence/absence (Jaccard distance) and abundance (Bray-Curtis distance) of microbial OTUs* It includes code for both rarified and non-rarified datasets* Code is included to display general figure and figures with communities and centroids color-coded based on factor levels (e.g. 3 different sampling dates, 2 different land-uses, 4 parts of a host body)* NMDS ordination plots produced in this code are basic, useful for initial exploration of data to help prioritize additional analysesTaxonomic and environmental data can be correlated with NMDS coordinates as a way to investigate which taxa may be distinctive of a community type (e.g. Gigasporaceae is associated with fungal communities in prairies, but not corn) and which environmental factors might be driving some of the differences (e.g. soil N increased as communities shifted to resemble wetland soils).  Use Bach_NMDS_TaxaEnv.R to explore these analyses and build NMDS with appropriate vectors and/or centroids.* Build NMDS for community data as in NMDS_exploration* Correlate taxonomic abundance to produce taxon “centroids” on NMDS to display taxa most associated with certain community types* Correlate environmental data and add “vector” arrows to NMDS to show direction of correlation (e.g. community type 1 found with greater total carbon)* Layer the figure to display both taxa centroids and environmental variables* Code also includes some examples of aesthetic manipulation in ggplot 2 to make the figure appropriate for presentation or publicationNMDS is used only to visualize community differences; non-parametric multivariate statistics (in this case, PERMANOVA) can be used to determine if community structure and composition are statistically different between levels of factors (e.g. sampling dates, ecosystems, locations, host species).  Used Bach_ITS_multivariate.R to perform the statistics to back up differences that may show up on the NMDS.  You will need to report these values in a manuscript.* This script uses the adonis() function in the vegan package to perform PERMANOVA analyses.  There are alternative to approaches to multivariate statistics, but this is a commonly used approach.* Code for both presence/absence and scaled abundance are included.  Keep in mind that you will need to perform the statistics on the same data standardization employed for NMDS.  In other words, if you present a presence/absence NMDS (Jaccard distance) to show differences between two sampling dates, you will need to perform the PERMANOVA statistics on the standardized presence/absence data.* Code is included to leverage the adonis() function to parse out interactions and differences between levels of factors when there are more than 2 levels.Relative abundance (scaled abundance) and rank abundance are common approaches for identifying key taxa shifts between factor levels.  For example, “the shift in community structure in prairies between July and October sampling dates was driven by a decrease in relative abundance of Agaricales and increase in relative abundance of Glomerales.”  We use relative abundance because raw read numbers do not reflect a true “abundance” measure, as copy number of genes can very tremendously between taxa (especially in fungi).  Relativizing read abundance allows interpretation in shifts in “abundance” between factor levels within a study.* This code includes calculations and summarization of relative abundance and rank abundance.    Rank abundance is primarily used for visualization, relative abundance for statistical interpretation.* This does not yet include code for building graphical visualization for these shifts (e.g. stacked bars).  (12/6/2015)